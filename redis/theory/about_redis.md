# ğŸ“ Redisë€?

ë ˆë””ìŠ¤(Redis)ëŠ” Remote Dictionary Serverì˜ ì•½ì.

â€œí‚¤-ê°’â€ êµ¬ì¡°ì˜ ë¹„ì •í˜• ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•œ, ì˜¤í”ˆ ì†ŒìŠ¤ ê¸°ë°˜ì˜ ë¹„ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ì‹œìŠ¤í…œ(DBMS)

> RedisëŠ” ë°ì´í„° ì²˜ë¦¬ ì†ë„ê°€ ì—„ì²­ ë¹ ë¥¸ NoSQL ë°ì´í„°ë² ì´ìŠ¤

---

### âœ… Redisì˜ ì¥ì 

- MySQLê³¼ ê°™ì€ RDBMSì˜ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë””ìŠ¤í¬(Disk)ì— ë°ì´í„°ë¥¼ ì €ì¥. 
- RedisëŠ” ë©”ëª¨ë¦¬(RAM)ì— ë°ì´í„°ë¥¼ ì €ì¥.
- ë””ìŠ¤í¬(Disk)ë³´ë‹¤ ë©”ëª¨ë¦¬(RAM)ì—ì„œì˜ ë°ì´í„° ì²˜ë¦¬ì†ë„ê°€ ì›”ë“±í•˜ê²Œ ë¹ ë¦„.    

> ë ˆë””ìŠ¤(Redis)ëŠ” ì¸ë©”ëª¨ë¦¬(in-memory)ì— ëª¨ë“  ë°ì´í„°ë¥¼ ì €ì¥.
> ê·¸ë˜ì„œ ë°ì´í„°ì˜ ì²˜ë¦¬ ì„±ëŠ¥ì´ êµ‰ì¥íˆ ë¹ ë¦„.

---

### âœ… Redis ì‚¬ìš© ì‚¬ë¡€

- âœ… **ìºì‹± (Caching)** 
- ì„¸ì…˜ ê´€ë¦¬ (Session Management)
- ì‹¤ì‹œê°„ ë¶„ì„ ë° í†µê³„ (Real-time Analystics)
- ë©”ì‹œì§€ í (Message Queue)
- ì§€ë¦¬ê³µê°„ ì¸ë±ì‹± (Geospatial Indexing)
- ì†ë„ ì œí•œ (Rate Limiting)
- ì‹¤ì‹œê°„ ì±„íŒ… ë° ë©”ì‹œì§• (Real-time Chat And Messaging)

---

<br>
<br>

## Redis ê¸°ë³¸ ëª…ë ¹ì–´

### âœ… ë°ì´í„°(Key, Value) ì €ì¥í•˜ê¸°

```
# set [key ì´ë¦„] [value]

$ set vedivero:hobby soccer

# ë„ì›Œì“°ê¸° í•´ì„œ ì €ì¥í•˜ë ¤ë©´ ìŒë”°ì˜´í‘œë¡œ ë¬¶ì–´ì£¼ë©´ ë¨

$ set vedivero:name "vedivero lee" 
```

### âœ… ë°ì´í„° ì¡°íšŒí•˜ê¸° (Keyë¡œ Value ê°’ ì¡°íšŒí•˜ê¸°)

```
# get [key ì´ë¦„]
$ get vedivero:name
$ get vedivero:hobby

# ì—†ëŠ” ë°ì´í„°ë¥¼ ì¡°íšŒí•  ê²½ìš° (nil)ì´ë¼ê³  ì¶œë ¥ë¨
$ get james:name 
```

### âœ… ì €ì¥ëœ ëª¨ë“  key ì¡°íšŒí•˜ê¸°

```
$ keys *
```

### âœ… ë°ì´í„° ì‚­ì œí•˜ê¸° (Keyë¡œ ë°ì´í„° ì‚­ì œí•˜ê¸°)

```
# del [key ì´ë¦„]
$ del vedivero:hobby
$ get vedivero:hobby # ì‚­ì œëëŠ” ì§€ í™•ì¸
Redis ê¸°ë³¸ ëª…ë ¹ì–´ ìµíˆê¸° 1
```

### âœ… ë°ì´í„° ì €ì¥ ì‹œ ë§Œë£Œì‹œê°„(TTL) ì •í•˜ê¸°
```
ë ˆë””ìŠ¤ëŠ” RDBMSì™€ëŠ” ë‹¤ë¥´ê²Œ ë°ì´í„° ì €ì¥ ì‹œ ë§Œë£Œì‹œê°„ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. ì¦‰, ì˜êµ¬ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ì§€ ì•Šê³  ì¼ì • ì‹œê°„ì´ ë˜ë©´ ë°ì´í„°ê°€
ì‚­ì œë˜ë„ë¡ ì…‹íŒ…í•  ìˆ˜ ìˆë‹¤.
ë ˆë””ìŠ¤ì˜ íŠ¹ì„±ìƒ ë©”ëª¨ë¦¬ ê³µê°„ì´ í•œì • ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ëª¨ë“  ë°ì´í„°ë¥¼ ë ˆë””ìŠ¤ì— ì €ì¥í•  ìˆ˜ ì—†ë‹¤. ë”°ë¼ì„œ ë§Œë£Œì‹œê°„(TTL)ì„ í™œìš©í•´ ìì£¼ ì‚¬ìš©í•˜
ëŠ” ë°ì´í„°ë§Œ ë ˆë””ìŠ¤ì— ì €ì¥í•´ë†“ê³  ì“°ëŠ” ì‹ìœ¼ë¡œ í™œìš©í•œë‹¤.
# set [key ì´ë¦„] [value] ex [ë§Œë£Œ ì‹œê°„(ì´ˆ)]
$ set vedivero:pet dog ex 30
```

### âœ… ë§Œë£Œì‹œê°„(TTL) í™•ì¸í•˜ê¸°

```
# ttl [key ì´ë¦„]

# ë§Œë£Œ ì‹œê°„ì´ ëª‡ ì´ˆ ë‚¨ì•˜ëŠ” ì§€ ë°˜í™˜
# í‚¤ê°€ ì—†ëŠ” ê²½ìš° -2ë¥¼ ë°˜í™˜
# í‚¤ëŠ” ì¡´ì¬í•˜ì§€ë§Œ ë§Œë£Œ ì‹œê°„ì´ ì„¤ì •ë¼ ìˆì§€ ì•Šì€ ê²½ìš°ì—ëŠ” -1ì„ ë°˜í™˜

$ ttl vedivero:pet
$ ttl vedivero:name
$ ttl james:name
```

### âœ… ëª¨ë“  ë°ì´í„° ì‚­ì œí•˜ê¸°
```
$ flushall
```


---

<br>
<br>

# ğŸ“ ë„¤ì´ë° ì»¨ë²¤ì…˜

íšŒì‚¬ë§ˆë‹¤ ì‚¬ìš©í•˜ëŠ” ì»¨ë²¤ì…˜ì´ ë‹¤ë¦„.

> ì½œë¡ ( : )ì„ í™œìš©í•´ ê³„ì¸µì ìœ¼ë¡œ ì˜ë¯¸ë¥¼ êµ¬ë¶„í•´ì„œ ì‚¬ìš©

### ì˜ˆì‹œ
`users:100:profile`

- ì‚¬ìš©ìë“¤(users) ì¤‘ì—ì„œ PKê°€ 100ì¸ ì‚¬ìš©ì(user)ì˜ í”„ë¡œí•„(profile)

`products:123:details`

- ìƒí’ˆë“¤(products) ì¤‘ì—ì„œ PKê°€ 123ì¸ ìƒí’ˆ(product)ì˜ ì„¸ë¶€ì‚¬í•­(details)


---

<br>
<br>

# ğŸ“ ìºì‹œ(Cache), ìºì‹±(caching)

âœ… ìºì‹œ(Cache)ë€, ì›ë³¸ ì €ì¥ì†Œë³´ë‹¤ ë¹ ë¥´ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ì„ì‹œ ë°ì´í„° ì €ì¥ì†Œë¥¼ ì˜ë¯¸

![alt text](image.png)

### í˜„ì—…ì—ì„œ ì‚¬ìš©í•˜ëŠ” ì˜ˆì‹œ

> â€œì´ APIëŠ” ì‘ë‹µ ì†ë„ê°€ ë„ˆë¬´ ëŠë¦°ë°? ì´ ë°ì´í„°ëŠ” ìºì‹±(Cahing) í•´ë‘ê³  ì“°ëŠ” ê²Œ ì–´ë•Œ?â€™

ì´ ë§ì„ í’€ì–´ì„œ ì„¤ëª…í•˜ìë©´ â€˜API ì‘ë‹µ ê²°ê³¼ë¥¼ ì›ë³¸ ì €ì¥ì†Œë³´ë‹¤ ë¹ ë¥´ê²Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ì„ì‹œ ë°ì´í„° ì €ì¥ì†Œì— ì €ì¥í•´ë‘ê³ , ë¹ ë¥´ê²Œ ì¡°íšŒí•  ìˆ˜ ìˆê²Œ
ë§Œë“œëŠ” ê²Œ ì–´ë•Œ?â€™ë¼ëŠ” ì˜ë¯¸


<br>
<br>

# ğŸ“ ë°ì´í„° ìºì‹± ì „ëµ

## âœ… Cache Aside (= Look Aside, Lazy Loading) ì „ëµ

- ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ ì£¼ë¡œ ì‚¬ìš©í•˜ëŠ” ì „ëµì´ Cache Aside ì „ëµ.
- Look Aside ì „ëµ ë˜ëŠ” Lazy Loading ì „ëµì´ë¼ê³  ë¶€ë¥¸ë‹¤. 

### Cache Aside ì‘ë™ ë°©ì‹ ì´í•´í•˜ê¸°

> ì²˜ìŒìœ¼ë¡œ ê²Œì‹œíŒ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•œ ìƒí™©ì„ ê°€ì • 

1. ì²˜ìŒ ê²Œì‹œíŒ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í–ˆê¸° ë•Œë¬¸ì— ë°ì´í„°ë² ì´ìŠ¤ì™€ ë ˆë””ìŠ¤ì—ëŠ” ì•„ë¬´ëŸ° ë°ì´í„°ë„ ì €ì¥ì´ ì•ˆ ë˜ì–´ ìˆë‹¤.
2. ì¼ë¶€ ì‚¬ìš©ìê°€ ë“¤ì–´ì™€ ê²Œì‹œê¸€ ì‘ì„±ì„ í•¨ìœ¼ë¡œì¨ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤. ì´ ë°ì´í„°ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥ëœë‹¤. (ë ˆë””ìŠ¤ì—ëŠ” ì €ì¥ë˜ì§€ ì•ŠëŠ”ë‹¤.)
3. ì‚¬ìš©ìê°€ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ë ¤ê³  ìš”ì²­í•œë‹¤. ì´ ë•Œ, ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ë°”ë¡œ ë°ì´í„° ì¡°íšŒë¥¼ í•˜ê¸° ì „ì— ë ˆë””ìŠ¤ì— ìˆëŠ” ì§€ ë¨¼ì € í™•ì¸í•œë‹¤.
4. ë ˆë””ìŠ¤ì— ë°ì´í„°ê°€ ì—†ëŠ” ê±¸ í™•ì¸í•œ ë’¤ì— ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì„œ ì‘ë‹µí•œë‹¤.
5. ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ì¡°íšŒí•œ ë°ì´í„°ë¥¼ ì‘ë‹µí•œ ë’¤ì— ë ˆë””ìŠ¤ì—ë„ ë°ì´í„°ë¥¼ ì €ì¥í•´ë‘”ë‹¤.
6. ë‹¤ì‹œ í•œ ë²ˆ ì‚¬ìš©ìê°€ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ë ¤ê³  ìš”ì²­í•œë‹¤.
7. ë ˆë””ìŠ¤ì— ì¡°íšŒí•˜ê³ ì í•˜ëŠ” ë°ì´í„°ê°€ ìˆëŠ” ì§€ í™•ì¸í–ˆë”ë‹ˆ, ë°ì´í„°ê°€ ì¡´ì¬í•´ì„œ ë ˆë””ìŠ¤ë¡œë¶€í„° ë°ì´í„°ë¥¼ ë°”ë¡œ ê°€ì ¸ì˜¨ë‹¤.

---

1. ìºì‹œì— ë°ì´í„°ê°€ ìˆì„ ê²½ìš° (= Cache Hit)
2. ìºì‹œì— ë°ì´í„°ê°€ ì—†ì„ ê²½ìš° (= Cache Miss)

> Cache Aside ì „ëµì€ ìºì‹œ(Cache)ì—ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³ , ì—†ë‹¤ë©´ DBë¥¼ í†µí•´ ì¡°íšŒí•´ì˜¤ëŠ” ë°©ì‹

<br>
<br>

## âœ… Write Around ì „ëµ

Cache Aside ì „ëµì´ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ì¡°íšŒí•  ì§€ì— ëŒ€í•œ ì „ëµì´ì—ˆë‹¤ë©´, Write Around ì „ëµì€ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ì“¸ ì§€(ì €ì¥, ìˆ˜ì •, ì‚­ì œ)ì— ëŒ€
í•œ ì „ëµì´ë‹¤.

Write Around ì „ëµì€ Cache Aside ì „ëµê³¼ ê°™ì´ ìì£¼ í™œìš©ë˜ëŠ” ì „ëµì´ë‹¤. Write Around ì „ëµì´ ì–´ë–¤ ë°©ì‹ì¸ì§€ â€˜ì €ì¥â€™ì˜ ì˜ˆì‹œ
ë¡œ ì•Œì•„ë³´ì.

Write Around ì „ëµì€ ìƒê°ë³´ë‹¤ ë„ˆë¬´ ê°„ë‹¨í•˜ë‹¤. ë°ì´í„°ë¥¼ ì €ì¥í•  ë•ŒëŠ” ë ˆë””ìŠ¤ì— ì €ì¥í•˜ì§€ ì•Šê³  ë°ì´í„°ë² ì´ìŠ¤ì—ë§Œ ì €ì¥í•˜ëŠ” ë°©ì‹ì´ë‹¤.

ê·¸ëŸ¬ë‹¤ê°€ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ ë ˆë””ìŠ¤ì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë°ì´í„°ë² ì´ìŠ¤ë¡œë¶€í„° ë°ì´í„°ë¥¼ ì¡°íšŒí•´ì™€ì„œ ë ˆë””ìŠ¤ì— ì €ì¥ì‹œì¼œì£¼ëŠ” ë°©ì‹ì´ë‹¤.


> Write Around ì „ëµì€ `ì“°ê¸° ì‘ì—…(ì €ì¥, ìˆ˜ì •, ì‚­ì œ)`ì„ ìºì‹œì—ëŠ” ë°˜ì˜í•˜ì§€ ì•Šê³ , DBì—ë§Œ ë°˜ì˜í•˜ëŠ” ë°©ì‹.

---

<br>
<br>

## Cache Aside, Write Around ì „ëµì˜ í•œê³„ì  / í•´ê²° ë°©ë²•

### ìºì‹œì˜ í•œê³„ì 

1. ìºì‹œëœ ë°ì´í„°ì™€ DB ë°ì´í„°ê°€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.

    Cache Asdieì™€ Write Around ì „ëµì„ ê°™ì´ ì¼ì„ ë•Œì˜ í•œê³„ì  ì¤‘ í•˜ë‚˜ëŠ” ìºì‹œëœ ë°ì´í„°ì™€ DB ë°ì´í„°ê°€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤ëŠ” ì .

    ì¡°ê¸ˆ ì–´ë µê²Œ í‘œí˜„í•˜ìë©´ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤ëŠ” ëœ».
    Write Around ì „ëµì— ë”°ë¥´ë©´ ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ë•Œ DBë§Œ ì—…ë°ì´íŠ¸ë¥¼ ì‹œí‚¤ê¸° ë•Œë¬¸ì— ê¸°ì¡´ì— ì €ì¥ëœ ë ˆë””ìŠ¤ì˜ ë°ì´í„° ê°’ê³¼ DBì˜ ë°ì´í„° ê°’
    ì€ ë‹¤ë¥¼ ìˆ˜ ë°–ì— ì—†ë‹¤.

    ì˜ˆë¥¼ ë“¤ì–´, ë¶„ëª… í”„ë¡œí•„ ìˆ˜ì •ì—ì„œ ë‚´ ì´ë¦„ì„ â€˜ì´í˜„ì„â€™ì—ì„œ â€˜ì´ì„í˜„â€™ë¡œ ë³€ê²½í•˜ê³  ë‚´ í”„ë¡œí•„ ì¡°íšŒë¥¼ í•´ë´¤ë”ë‹ˆ ë‚´ ì´ë¦„ì´ ì—¬ì „íˆ â€˜ì´í˜„ì„â€™ì´ë¼ê³  í‘œì‹œëœë‹¤ëŠ” ê²ƒì´ë‹¤.

2. ìºì‹œì— ì €ì¥í•  ìˆ˜ ìˆëŠ” ê³µê°„ì´ ë¹„êµì  ì‘ë‹¤.

    DBëŠ” ë””ìŠ¤í¬(Disk)ì— ì €ì¥í•´ì„œ ë§ì€ ì–‘ì„ ì €ì¥í•˜ê¸° ìš©ì´í•˜ì§€ë§Œ, ìºì‹œëŠ” ë©”ëª¨ë¦¬(RAM)ì— ì €ì¥í•˜ê¸° ë•Œë¬¸ì— DBì— ë¹„í•´ ë§ì€ ì–‘ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ê°€ ì—†ë‹¤. 


<br>
<br>

## ì´ í•œê³„ë¥¼ ì–´ë–»ê²Œ ê·¹ë³µí• ê¹Œ?

### 1. ìºì‹œëœ ë°ì´í„°ì™€ DB ë°ì´í„°ê°€ ì¼ì¹˜í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.

ìºì‹œì™€ DBì˜ ë°ì´í„°ë¥¼ ì¼ì¹˜ì‹œí‚¤ê¸° ìœ„í•´, ë°ì´í„°ë¥¼ ìˆ˜ì •í•  ë•Œë§ˆë‹¤ ë™ì‹œì— ì—…ë°ì´íŠ¸ ì‹œí‚¤ë©´ ì„±ëŠ¥ì ìœ¼ë¡œ ëŠë ¤ì§„ë‹¤. ê·¸ë ‡ë‹¤ê³  ì„±ëŠ¥ í–¥ìƒì„ ìœ„í•´ DBì˜ ë°ì´í„°ë§Œ ì—…ë°ì´íŠ¸ ì‹œí‚¤ë©´ ìºì‹œì™€ DBì˜ ë°ì´í„°ê°€ ì¼ì¹˜í•˜ì§€ ì•Šê²Œ ëœë‹¤.

í•˜ì§€ë§Œ ì–´ì©” ìˆ˜ ì—†ë‹¤.

ì–´ë–¤ ì„ íƒì„ í•˜ë“  ê¸°íšŒ ë¹„ìš©(Trade Off)ì´ ë°œìƒí•œë‹¤.

ë¬´ì–¸ê°€ë¥¼ ì–»ìœ¼ë©´ ë¬´ì–¸ê°€ë¥¼ í¬ê¸°í•´ì•¼ í•œë‹¤.

ëŒ€ë¶€ë¶„ì˜ ê°œë°œ ê¸°ìˆ ë“¤ì´ ì¥ì ì´ ìˆìœ¼ë©´ ë‹¨ì ì´ ìˆë‹¤.

ë”°ë¼ì„œ ë°ì´í„° ì¡°íšŒ ì„±ëŠ¥ ê°œì„  ëª©ì ìœ¼ë¡œ ë ˆë””ìŠ¤ë¥¼ ì“°ëŠ” ê²½ìš°ì—ëŠ” ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ í¬ê¸°í•˜ê³  ì„±ëŠ¥ í–¥ìƒì„ íƒí•œ ê²ƒì´ë‹¤.

ì´ëŸ¬í•œ ì´ìœ ë¡œ ì¸í•´ ìºì‹œë¥¼ ì ìš©ì‹œí‚¤ê¸°ì— ì ì ˆí•œ ë°ì´í„°ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

- ìì£¼ ì¡°íšŒë˜ëŠ” ë°ì´í„°ì˜ ë³€í•˜ì§€ ì•ŠëŠ” ë°ì´í„°
- ì‹¤ì‹œê°„ìœ¼ë¡œ ì •í™•í•˜ê²Œ ì¼ì¹˜í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ” ë°ì´í„°
- í•˜ì§€ë§Œ ì¥ê¸°ê°„ ë°ì´í„°ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ê±´ ë¬¸ì œê°€ ë  ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ ì ì ˆí•œ ì£¼ê¸°ë¡œ ë°ì´í„°ë¥¼ ë™ê¸°í™”ì‹œì¼œì£¼ì–´ì•¼ í•œë‹¤. 

ì´ ë•Œ í™œìš©í•˜ëŠ” ê¸°ëŠ¥ì´ ë ˆë””ìŠ¤ì˜ TTL ê¸°ëŠ¥(ë§Œë£Œ ì‹œê°„ ì„¤ì • ê¸°ëŠ¥)ì´ë‹¤.

ì¼ì • ì‹œê°„ì´ ì§€ë‚˜ë©´ ë°ì´í„°ê°€ ìºì‹œì—ì„œ ì‚­ì œëœë‹¤.

ê·¸ëŸ¼ íŠ¹ì • ì‚¬ìš©ìê°€ ì¡°íšŒë¥¼ í•˜ëŠ” ìˆœê°„ Cache Missê°€ ë°œìƒí•œë‹¤.

DBì˜ ë°ì´í„°ë¥¼ ìƒˆë¡œ ì¡°íšŒí•´ì™€ì„œ ìºì‹œì— ë°ì´í„°ë¥¼ ë„£ê²Œ ëœë‹¤.

> ì¦‰, ë°ì´í„°ê°€ ìƒˆë¡­ê²Œ ê°±ì‹ ë˜ëŠ” íš¨ê³¼ê°€ ìˆëŠ” ê²ƒì´ë‹¤.

### 2. ìºì‹œì— ì €ì¥í•  ìˆ˜ ìˆëŠ” ê³µê°„ì´ ë¹„êµì  ì‘ë‹¤.

ìœ„ì—ì„œ í™œìš©í–ˆë˜ TTL ê¸°ëŠ¥(ë§Œë£Œ ì‹œê°„ ì„¤ì • ê¸°ëŠ¥)ì„ í™œìš©í•˜ë©´ ìºì‹œì˜ ê³µê°„ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì“¸ ìˆ˜ ìˆë‹¤.

ì™œëƒë©´ ìì£¼ ì¡°íšŒí•˜ì§€ ì•ŠëŠ” ë°ì´í„°ëŠ”
ë§Œë£Œ ì‹œê°„ì— ì˜í•´ ë°ì´í„°ê°€ ì‚­ì œë˜ê¸° ë•Œë¬¸ì´ë‹¤. 


<br>
<br>

## ìºì‹±ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ ê°œì„ ì„ í•˜ê¸° ì „ OOOì„ í•­ìƒ ë¨¼ì €í•´ì•¼ í•œë‹¤!

### âœ… ë°ì´í„° ì¡°íšŒ ì„±ëŠ¥ì„ ê°œì„ í•˜ëŠ” ë°©ë²•

ë°ì´í„° ì¡°íšŒ ì„±ëŠ¥ì„ ê°œì„ í•˜ëŠ” ë°©ë²•ì€ ë‹¤ì–‘.
- SQL íŠœë‹
- ìºì‹± ì„œë²„ í™œìš© (Redis ë“±)
- ë ˆí”Œë¦¬ì¼€ì´ì…˜ (Master/Slave êµ¬ì¡°)
- ìƒ¤ë”©
- DB ìŠ¤ì¼€ì¼ì—… (CPU, Memory, SSD ë“± í•˜ë“œì›¨ì–´ ì—…ê·¸ë ˆì´ë“œ)

### âœ… ë§ì€ ì„±ëŠ¥ ê°œì„  ë°©ë²• ì¤‘ â€˜SQL íŠœë‹â€™ì„ ì™œ ë¨¼ì € ê³ ë ¤í•´ì•¼ í• ê¹Œ?

#### 1. SQL íŠœë‹ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ë°©ë²•ì€ ì¶”ê°€ì ì¸ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•´ì•¼ í•¨.   
    
- ë”°ë¼ì„œ ê¸ˆì „ì , ì‹œê°„ì  ë¹„ìš©ì´ ì¶”ê°€ì ìœ¼ë¡œ ë°œìƒ.
- ì¡°ê¸ˆ ë” ë³µì¡í•´ì§„ ì‹œìŠ¤í…œ êµ¬ì¡°ë¡œ ì¸í•´ ê´€ë¦¬ ë¹„ìš© ì¦ê°€.
- ê·¸ì— ë¹„í•´ SQL íŠœë‹ì€ ê¸°ì¡´ì˜ ì‹œìŠ¤í…œ ë³€ê²½ ì—†ì´ ì„±ëŠ¥ ê°œì„ .

#### 2. ê·¼ë³¸ì ì¸ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì´ SQL íŠœë‹ì¼ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤. 

SQL ìì²´ê°€ ë¹„íš¨ìœ¨ì ìœ¼ë¡œ ì‘ì„±ëë‹¤ë©´ ì•„ë¬´ë¦¬ ì‹œìŠ¤í…œì ìœ¼ë¡œ ì„±ëŠ¥ì„ ê°œì„ í•œ
ë‹¤ê³  í•˜ë”ë¼ë„ í•œê³„ê°€ ìˆë‹¤.

í•˜ì§€ë§Œ SQL íŠœë‹ì„ í†µí•´ ê¸°ë³¸ì ìœ¼ë¡œ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¨ë‹¤ë©´, ì‹œìŠ¤í…œì ì¸ ì„±ëŠ¥ ê°œì„ ì´ í•„ìš”ì—†ê±°ë‚˜ í›¨ì”¬ ê°„ë‹¨í•œ ê°œì„ ìœ¼ë¡œ í° ì„±ëŠ¥ ê°œì„  íš¨ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

> DB ì„±ëŠ¥ ê°œì„  ë°©ë²•ë“¤ ì¤‘ ê°€ì¥ ê°€ì„±ë¹„ê°€ ì¢‹ì€ ë°©ë²•ì´ SQL íŠœë‹.


---

<br>
<br>

# ğŸ“ Docker Composeë¡œ Redis, Spring Boot ê°€ë™í•˜ê¸°

## 1. Dockerfile ë§Œë“¤ê¸°


íŒŒì¼ ëª… : project/`Dockerfile`
```
FROM openjdk:17-jdk

COPY build/libs/*SNAPSHOT.jar app.jar

ENTRYPOINT ["java", "-jar", "/app.jar"]
```

---

## 2. compose.yml ë§Œë“¤ê¸°

íŒŒì¼ ëª… : project/`compose.yml`

```
services:
    api-server:
        build: .           # Dockerfile íŒŒì¼ë¡œ ë¹Œë“œ
        ports:
            - 8080:8080    # Portë¼ë¦¬ Mapping
        depends_on:
            cache-server:
                condition: service_healthy     # Redisê°€ë™ í›„, Spring Boot Server ê°€ë™
    cache-server:
        image: redis        # Imageë¡œ Redis ì‚¬ìš©
        ports:
            - 6379:6379     # Redis ê¸°ë³¸ Port
    healthcheck:            # Redisê°€ ì˜ ê°€ë™ëœë‹¤ëŠ” ì¡°ê±´
        test: [ "CMD", "redis-cli", "ping" ]
        interval: 5s
        retries: 10
 ```

 ---

 ### Local í™˜ê²½ì—ì„œ Docker Compose ì‹¤í–‰ TEST

 - Testë¥¼ ìœ„í•œ ê¸°ì¡´ Redis, Spring Boot ì¢…ë£Œ

#### Redis ì¢…ë£Œ ëª…ë ¹ì–´

    brew services stop redis


#### Redis ì¢…ë£Œ í™•ì¸ ëª…ë ¹ì–´

    brew services info redis

#### Spring Boot Server ì¢…ë£Œ í™•ì¸ ëª…ë ¹ì–´

    lsof -i:8080


---

## 3. application.yml ìˆ˜ì •

```
# local í™˜ê²½
spring:
    profiles:
        default: local
    datasource:
        # ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ê°€ë™ë˜ëŠ” ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œì˜ ì£¼ì†Œ(í•´ë‹¹ ì»¨í…Œì´ë„ˆì—ëŠ” MySQLì´ ë¯¸ì„¤ì¹˜)
        # url: jdbc:mysql://localhost:3306/mydb 
        url: jdbc:mysql://host.docker.internal:3306/mydb 
        username: root
        password: password
        driver-class-name: com.mysql.cj.jdbc.Driver
    jpa:
       hibernate:
            ddl-auto: update
        show-sql: true
    data:
        redis:
            # Redisë„ ë§ˆì°¬ê°€ì§€
            # host: localhost
            host: cache-server  # compose.ymlì—ì„œ ì •ì˜í•œ Redis Nameê³¼ ì¼ì¹˜
            port: 6379
logging:
    level:
    org.springframework.cache: trace
---
# prod í™˜ê²½
spring:
    config:
    activate:
    on-profile: prod
    datasource:
        url: jdbc:mysql://instagram-db.coseefawhrzc.ap-northeast-2.rds.amazonaws.com:3306/mydb
    username: admin
    password: password
```

---

## 4. Build

- server build

    ```
    ./gradlew clean build -x test
    ```

- docker build

    ```
    docker compose up --build -d
    ```

#### Redis ìƒì„± â¡ï¸ Redis ì²´í¬ â¡ï¸ Spring Boot Server ê°€ë™
    
    

---

### docker compose

- ì‹¤ì‹œê°„ ë¡œê·¸ ì¶œë ¥ ì„¤ì • ëª…ë ¹ì–´

    ```
    docker compose logs -f
    ```


<br>
<br>
<br>

# AWS EC2ì—ì„œ Docker Composeë¡œ Redis, Spring Boot ê°€ë™í•˜ê¸°

## productionì—ì„œ ì‚¬ìš©í•  ì„¤ì • íŒŒì¼ ë¶„ë¦¬

<br>

íŒŒì¼ ëª… : project/`Dockerfile-prod` 

```
FROM openjdk:17-jdk

COPY build/libs/*SNAPSHOT.jar app.jar

ENTRYPOINT ["java", "-jar", "-Dspring.profiles.active=prod", "/app.jar"]
```

<br>

íŒŒì¼ ëª… : project/`compose-prod.yml`

```
services:
    api-server:
        build:
        context: .  # í˜„ì¬ ê²½ë¡œë¥¼ ì˜ë¯¸
        dockerfile: ./Dockerfile-prod   # íŒŒì¼ì´ë¦„ì„ ì˜ë¯¸
        ports:
            - 8080:8080
        depends_on:
            cache-server:
             condition: service_healthy
    cache-server:
        image: redis
        ports:
            - 6379:6379
        healthcheck:
            test: [ "CMD", "redis-cli", "ping" ]
            interval: 5s
            retries: 10
```

---

<br>

## Githubì— ì†ŒìŠ¤ ì½”ë“œ Push

```
git add .
git commit -m "docker"
git push origin main

```


---
<br>

## EC2ì—ì„œ ì†ŒìŠ¤ ì½”ë“œ Pull

```
git pull origin main
```

---

<br>

## EC2ì— Docker Compose ì„¤ì¹˜í•˜ê¸°

- Docker Compose ì„¤ì¹˜ ëª…ë ¹ì–´
    ```
    $ sudo apt-get update && \
    sudo apt-get install -y apt-transport-https ca-certificates curl software-properties-common && \
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - && \
    sudo apt-key fingerprint 0EBFCD88 && \
    sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
    sudo apt-get update && \
    sudo apt-get install -y docker-ce && \
    sudo usermod -aG docker ubuntu && \
    newgrp docker && \
    sudo curl -L "https://github.com/docker/compose/releases/download/2.27.1/docker-compose-$(uname -s)-$(unam
    sudo chmod +x /usr/local/bin/docker-compose && \
    sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose
    ```


- Docker ë²„ì „ í™•ì¸ ëª…ë ¹ì–´
    ```
    $ docker -v

    Docker version xx.x.x, build xxxxxxx
    ```

- Docker Compose ë²„ì „ í™•ì¸ ëª…ë ¹ì–´
    ```
    $ docker compose version

    Docker Compose version vx.xx.x
    ```

---

- Redis ì¤‘ì§€ ëª…ë ¹ì–´

    ```
    sudo systemctl stop redis


    ```

- Redis ìƒíƒœ í™•ì¸ ëª…ë ¹ì–´

    ```
    sudo systemctl status redis

    # ì‹¤í–‰ ì¤‘
    ...
    Active : active
    ...

    # ì¤‘ì§€
    ...
    Active : inactive (dead)
    ...
    ```

---

- Spring Boot ê°€ë™ ì—¬ë¶€ í™•ì¸

    ```
    sudo lsof -i:8080
    ```

- Spring Boot ì •ì§€ ëª…ë ¹ì–´

    ```
    kil <PID Number>
    ```

---

## Spring Boot ê°€ë™í•˜ê¸°

- ë¹Œë“œ

    ```
    ./gradlew clean build -x test
    ```

## Docker Compose

- ë¹Œë“œ
    ```
    docker compose -f compose-prod.yml up --build -d
    ```

- Docker ê°€ë™ ì²´í¬

    ```
    docker ps
    ```

- Dokcer Compose ì¢…ë£Œ

    ```
    docker compose down
    ```

---

## APIí˜¸ì¶œ í…ŒìŠ¤íŠ¸

```
xx.xxx.xxx.xxx:xxxx/boards
```

<br>
<br>
<br>

# ğŸ“ ElastiCache

## í˜„ì—…ì—ì„œ EC2ì— Redisë§ê³ , ElastiCacheë¥¼ ì“°ëŠ” ì´ìœ 

- Redis 

    ì¼ì¼ì´ Redisë¥¼ ì„¤ì¹˜í•˜ê³  ì…‹íŒ…í•˜ê³  ê´€ë¦¬í•˜ë©´ì„œ í™•ì¥ê¹Œì§€ í•˜ë ¤ë©´ ì‹ ê²½ì“¸ ê²Œ ìƒê°ë³´ë‹¤ ë§ë‹¤.

- ElastiCache

    ì‰¬ìš´ ì„¸íŒ…, ì‰¬ìš´ í™•ì¥, ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ ê¸°ë³¸ ì œê³µ, ì¥ì•  ë°œìƒ ê°€ëŠ¥ì„±ë„ í›¨ì”¬ ì ë‹¤.

> ì‚¬ìš©ì€ ì‰½ê²Œ ê°€ëŠ¥í•˜ë‚˜, ì‘ë™ ì›ë¦¬ë¥¼ ì´í•´í•˜ëŠ” ê²ƒì´ ì¤‘ìš”.


<br>
<br>
<br>

## ElastiCache

### ê¸°ì¡´ ì•„í‚¤í…ì²˜
    
![alt text](image-1.png)

### ElastCache ì•„í‚¤í…ì²˜

![alt text](image-2.png)

- ì‚¬ìš©ìê°€ ìŠ¤í”„ë§ì— APIìš”ì²­
- ë°ì´í„° ë² ì´ìŠ¤ ì¡°íšŒ ì „, ìºì‹œ ì„œë²„ë¥¼ ì²´í¬
- ìºì‹œ ì„œë²„ì— ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë°ì´í„°ë¥¼ ì‘ë‹µ
- ìºì‹œ ì„œë²„ì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë°ì´í„° ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒ
- ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‘ë‹µí•œ ë°ì´í„°ë¥¼ ElastiCacheì— ì €ì¥

    > Cache Aside

<br>
<br>
<br>

## Spring Boot, ElastiCache ì—°ê²°

- ElastiCache ì—°ê²°í•˜ê¸° ìœ„í•œ ì˜µì…˜ ìˆ˜ì •

    - application.yml
        - ìºì‹œ ì •ë³´ ë³€ê²½í•˜ê¸°
        ```
        spring:
            config:
                activate:
                    on-profile: prod
            datasource:
                url: jdbc:mysql://coseefawhrzc.ap-northeast-2.rds.amazonaws.com:3306/mydb
                username: admin
                password: password
            data:
                redis:
                    # AWS ElastiCache ê¸°ë³¸ ì—”ë“œí¬ì¸íŠ¸ URL
                    host: s8nyjv.ng.0001.apn2.cache.amazonaws.com
                    port: 6379
        ```


- git push

- EC2ì—ì„œ git pull

- EC2ì—ì„œ Build

    ```
    ./gradlew clean build -x test
    ```

- EC2ì—ì„œ Spring Boot ê°€ë™

    - ë¹Œë“œëœ jar íŒŒì¼ ìœ„ì¹˜ë¡œ ì´ë™ 

    - jar íŒŒì¼ ì‹±í–‰
        ```
        java -jar -Dspring.profiles.active=prod redis-in-spring-0.0.1-SNAPSHOT.jar
        ```

---

## ElastiCache Serverë¡œ ìš”ì²­

xx.xxx.xxx.xxx:xxx/boards

---

## ElastiCacheì— Cacheê°€ ì €ì¥ë˜ê³  ìˆëŠ”ì§€ ì²´í¬

- EC2(ubuntu)
    ```
    redis-cli -h <ì—”ë“œí¬ì¸íŠ¸ URL>

    keys *

    get getBoards::boards:page:1:size:10
    ```